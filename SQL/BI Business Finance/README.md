# Comprehensive SQL Analysis and Case Study: Identifying Key Drivers of GMV Growth at Shopee

## Part A:

### 1) Please provide the top 10% seller list (ranked by GMV) for each of the states in Malaysia, for the month of Jan’23.
-  Data output should include seller’s shop id, total order & total GMV in that month.

        with seller_stats as (
                select 
                        seller_delivery_state,
                        shop_id,
                        count(order_id) AS total_order,
                        sum(gmv) AS total_gmv
                from 
                        order_table
                where 
                        to_char(order_date, 'MON-YY') = 'JAN-23'
                group by 
                        seller_delivery_state, shop_id
        ),
        ranked_sellers as (
                select 
                        seller_delivery_state,
                        shop_id,
                        total_order,
                        total_gmv,
                        rank() over (partition by seller_delivery_state order by total_gmv DESC) as rank,
                        percent_rank() over (partition by seller_delivery_state order by total_gmv desc) AS percent_rank
                from 
                        seller_stats
        )
        select 
                seller_delivery_state,
                shop_id,
                total_order,
                total_gmv
        from 
                ranked_sellers
        where 
                percent_rank <= 0.1
                order by
                seller_delivery_state, rank;


### 2) Please provide the number of buyers who have purchased in Jan’23, and continued to purchase in the next 2 months (Feb’23 and Mar’23)
- Data output should have the number of buyers for all 3 months.

        select count(distinct buyer_id) as buyers_all_3_months
        from order_table
        where to_char(order_date, 'MON-YY') in ('JAN-23', 'FEB-23', 'MAR-23')
        group by buyer_id
        having count(distinct to_char(order_date, 'MON-YY')) = 3;
        ),
        buyer_feb as (
        select distinct buyer_id
        from order_table
        where to_char(order_date, 'MON-YY') = 'FEB-23'
        ),
        buyer_mar as (
        select distinct buyer_id
        from order_table
        where to_char(order_date, 'MON-YY') = 'MAR-23'
        )
        select count(*) as buyers_all_3_months
        from buyer_jan
        where buyer_id IN (
        select buyer_id from buyer_feb
        intersect
        select buyer_id from buyer_mar
        );


### 3) Please provide the full list of orders at order id level, for our FMCG seller (superbaby, shopid: 788688), along with the total revenue generated by each order.
- Total revenue is defined as commission fee + ads spent by seller
- Note that given ads spent data is at seller level, we have to apportion this back into order level to achieve the granularity required. The logic suggested for this study is to apportion by gmv.

                with total_gmv as (
        -- Calculate total GMV for the seller
        select 
                shop_id, 
                SUM(gmv) as total_gmv
        from order_table
        where shop_id = 788688
        group by shop_id
        ),
        order_revenue as (
        -- Calculate revenue for each order
        select 
                o.order_id,
                o.shop_id,
                o.gmv,
                o.commission_fee,
                a.ads_spent,
                t.total_gmv,
                -- Apportion ads spent by GMV proportion and calculate total revenue
                o.commission_fee + 
                (o.gmv / t.total_gmv) * a.ads_spent AS total_revenue
        from order_table o
        join ads_table a on o.shop_id = a.shop_id
        join total_gmv t on o.shop_id = t.shop_id
        where o.shop_id = 788688
        )
        -- Final result: List of orders with total revenue
        select 
        order_id, 
        total_revenue
        from order_revenue
        order BY order_id;

## Part B: Case Study
### Case: Shopee sees a month-on-month growth of +10% in GMV from Jan to Feb, what is contributing to the growth?

1. Write the problem statement & explain the method of approach
Guide
- Tell us how you intend to answer this question with data (using the 2 data tables above)
- What is the data you need, how should it be pulled?
- What is your hypothesis?


--- Method of Approach

Step 1: Define Key Metrics

To understand what drives GMV growth, we will examine several key factors:

- Order Volume: The number of orders placed.
- Average Order Value (AOV): The average GMV per order.
- Ads Spent: Advertising expenditure, which could influence sales.
- Buyer Retention and Acquisition: The number of repeat buyers and new buyers.

Step 2: Data Required and How to Pull It

Order Volume:

- From the order_table, count the number of orders in January (JAN-23) and February (FEB-23).

        select 
        to_char(order_date, 'MON-YY') as month, 
        count(order_id) as total_orders
        from order_table
        where to_char(order_date, 'MON-YY') in ('JAN-23', 'FEB-23')
        group by to_char(order_date, 'MON-YY');

Average Order Value (AOV):

- Calculate the average GMV per order for both months.

        select 
        to_char(order_date, 'MON-YY') as month, 
        avg(gmv) as avg_order_value
        from order_table
        where to_char(order_date, 'MON-YY') IN ('JAN-23', 'FEB-23')
        group by to_char(order_date, 'MON-YY');


Ads Spent:
- Sum the ads_spent for the seller and compare across the two months to see if increased advertising correlates with higher GMV.

                select 
                to_char(transaction_date, 'MON-YY') as month, 
                sum(ads_spent) as total_ads_spent
                from ads_table
                where to_char(transaction_date, 'MON-YY') in ('JAN-23', 'FEB-23')
                group by to_char(transaction_date, 'MON-YY');

        Buyer Retention and Acquisition:
        - Identify the number of repeat buyers and new buyers in February compared to January.

        -- Repeat Buyers
        select 
        count(distinct buyer_id) as repeat_buyers
        from order_table
        where to_char(order_date, 'MON-YY') = 'FEB-23'
        and buyer_id in (
        select distinct buyer_id
        from order_table
        where to_char(order_date, 'MON-YY') = 'JAN-23'
        );

        -- New Buyers
        select 
        count(distinct buyer_id) as new_buyers
        from order_table
        where to_char(order_date, 'MON-YY') = 'FEB-23'
        and buyer_id not in (
        select distinct buyer_id
        from order_table
        where to_char(order_date, 'MON-YY') = 'JAN-23'
        );

Step 3: Formulate Hypotheses

Hypothesis 1: 
Increase in Order Volume
The growth in GMV is primarily driven by an increase in the total number of orders placed in February.

Hypothesis 2: 
Increase in Average Order Value (AOV)
The GMV growth is due to higher average spending per order, possibly influenced by promotions or higher-priced items being sold.

Hypothesis 3: 
Higher Advertising Spend
Increased ads spending led to higher visibility and sales, thereby contributing to the GMV growth.

Hypothesis 4: 
Buyer Retention and Acquisition
A combination of more repeat buyers and the acquisition of new buyers contributed to the GMV increase.
